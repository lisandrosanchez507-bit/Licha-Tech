<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Licha Tech | Plataforma Oficial</title>

<link href="https://fonts.cdnfonts.com/css/satoshi" rel="stylesheet">

<style>
/* ======= TODO TU CSS ORIGINAL, SIN TOCAR ======= */
:root{
  --bg-main:#0b0f14;
  --bg-alt:#101d2b;
  --panel:#161616;
  --panel-2:#1e1e1e;
  --text:#ffffff;
  --muted:#9aa4af;
  --accent:#00b4ff;
  --danger:#ff3b3b;
  --shadow:0 20px 40px rgba(0,0,0,.6);
}
body.light{
  --bg-main:#eef3f8;
  --bg-alt:#dde7f2;
  --panel:#ffffff;
  --panel-2:#f1f1f1;
  --text:#0b0b0b;
  --muted:#555;
  --accent:#007acc;
}
*{box-sizing:border-box}
body{margin:0;font-family:'Satoshi',sans-serif;color:var(--text)}
.hidden{display:none}
.msg{margin-bottom:18px}
.msg small{color:var(--muted)}
</style>
</head>

<body>

<!-- ===== TODO TU HTML ORIGINAL, SIN TOCAR ===== -->

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDPR40KPSX1BXu6nDOrZ2Muj-oyElZ1IQ8",
  authDomain:"licha-tech-ec128.firebaseapp.com",
  projectId:"licha-tech-ec128",
  storageBucket:"licha-tech-ec128.appspot.com",
  messagingSenderId:"232472382052",
  appId:"1:232472382052:web:9fb54fdbfc72f1c310ad71"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

const ADMIN_EMAIL="lisandrosanchez507@gmail.com";
let lastCount=0;

/* ===== AUTH (SIN CAMBIOS) ===== */
function registrar(){
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .catch(e=>alert(e.message));
}
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .catch(e=>alert(e.message));
}
function logout(){ auth.signOut(); }

/* ===== ENVIAR MENSAJE (AGREGA SOLO admin:true) ===== */
function enviarMensaje(){
  if(!mensaje.value.trim())return;

  db.collection("mensajes").add({
    texto:mensaje.value,
    user:auth.currentUser.email,
    admin:auth.currentUser.email===ADMIN_EMAIL,
    fecha:firebase.firestore.FieldValue.serverTimestamp()
  });

  mensaje.value="";
}

/* ===== VACIAR CHAT (IGUAL) ===== */
function vaciarChat(){
  if(!confirm("¬øVaciar todo el chat?"))return;
  db.collection("mensajes").get().then(s=>{
    s.forEach(d=>d.ref.delete());
  });
}

/* ===== CHAT + NOTIFICACI√ìN ===== */
db.collection("mensajes").orderBy("fecha","asc").onSnapshot(snap=>{
  mensajes.innerHTML="";
  adminMensajes.innerHTML="";

  if(snap.size>lastCount){
    document.title="üîî Nuevo mensaje - Licha Tech";
    setTimeout(()=>document.title="Licha Tech | Plataforma Oficial",3000);
  }
  lastCount=snap.size;

  snap.forEach(doc=>{
    const m=doc.data();
    const f=m.fecha?m.fecha.toDate().toLocaleString():"";
    const nombre=m.admin?"üõ† Soporte Licha Tech":m.user;

    const html=`
      <div class="msg">
        <b>${nombre}</b><br>
        ${m.texto}<br>
        <small>${f}</small>
      </div>`;

    mensajes.innerHTML+=html;
    adminMensajes.innerHTML+=html;
  });

  mensajes.scrollTop=mensajes.scrollHeight;
  adminMensajes.scrollTop=adminMensajes.scrollHeight;
});

/* ===== SESI√ìN (SIN CAMBIOS) ===== */
auth.onAuthStateChanged(user=>{
  auth.classList.toggle("hidden",!!user);
  chat.classList.toggle("hidden",!user);
  admin.classList.toggle("hidden",!user||user.email!==ADMIN_EMAIL);
});

/* ===== UI ===== */
function toggleTheme(){
  document.body.classList.toggle("light");
  themeBtn.innerText=document.body.classList.contains("light")?"‚òÄÔ∏è Claro":"üåô Oscuro";
}
function copiar(){
  navigator.clipboard.writeText(cmd.innerText);
  alert("Comando copiado");
}
</script>

</body>
</html>
